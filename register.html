<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2DWORLD - Register</title>
  <link rel="stylesheet" href="./styles.css">
  <style>
    .header{ background:linear-gradient(#1279e8,#0b3fa8); border:1px solid rgba(255,255,255,.25); box-shadow:0 6px 16px rgba(0,0,0,.28); padding:10px; position:relative; }
    .top-actions{ position:absolute; right:10px; top:10px; display:flex; gap:8px; align-items:center; }
    .playNowTop{ display:inline-block; padding:4px 10px; font-weight:bold; color:#fff; border:1px solid rgba(0,0,0,.45); background:linear-gradient(#5ee25a,#1c9a1a); border-radius:3px; }
    .loginTop{ display:inline-block; padding:4px 10px; font-weight:bold; color:#fff; border:1px solid rgba(0,0,0,.45); background:linear-gradient(#6bb7ff,#2b7bd4); border-radius:3px; }
    .titlebar{ font-family: Impact, Arial Black, sans-serif; letter-spacing:1px; color:#fff; font-size:34px; }
    .wrap{ background:#f5f5f5; border:1px solid rgba(0,0,0,.35); border-top:none; box-shadow:0 10px 22px rgba(0,0,0,.25); padding:10px; }
    .main{ display:flex; gap:10px; }
    .left{ width:600px; } .right{ width:280px; }
    .bigbox .box-h{ background:linear-gradient(#4a4a4a,#222); color:#fff; }
    .sidebox .box-h{ background:linear-gradient(#4a4a4a,#222); color:#fff; }
    .genderRow{ display:flex; gap:18px; align-items:center; margin-top:10px; }
    .avatarRow{ display:flex; gap:30px; justify-content:center; padding:10px 0 4px; }
    .avatar{ width:140px; height:160px; border:1px solid #aaa; background:linear-gradient(#fff,#eaeaea); display:flex; align-items:center; justify-content:center; font-weight:bold; color:#777; }
    .continueRow{ text-align:center; margin-top:12px; }
    .continueBtn{ padding:6px 18px; font-weight:bold; border:1px solid rgba(0,0,0,.55); background:linear-gradient(#ffe37b,#ffb53a); cursor:pointer; }
    .statusLine{ margin-top:8px; font-size:11px; color:#444; }
    .small{ font-size:11px; color:#666; }
  </style>
</head>
<body>
  <div id="viewport"><div id="page">
    <div class="header">
      <div class="titlebar">2DWORLD</div>
      <div class="top-actions">
        <a class="playNowTop" href="./account.html">PLAY NOW</a>
        <a class="loginTop" href="./index.html">Login</a>
      </div>
      <ul class="nav" style="margin-top:10px;">
        <li><a href="./index.html">My 2DWORLD</a></li>
        <li><a href="#" onclick="return false;">Worlds</a></li>
        <li><a href="#" onclick="return false;">Catalog</a></li>
        <li><a href="#" onclick="return false;">People</a></li>
        <li><a href="#" onclick="return false;">Creator Club</a></li>
        <li><a href="#" onclick="return false;">Events</a></li>
        <li><a href="#" onclick="return false;">Forum</a></li>
        <li><a href="#" onclick="return false;">News</a></li>
        <li><a href="#" onclick="return false;">Parents</a></li>
        <li><a href="#" onclick="return false;">Help</a></li>
      </ul>
    </div>

    <div class="wrap">
      <div class="main">
        <div class="left">
          <div class="box bigbox">
            <div class="box-h">Create a Free 2DWORLD Account</div>
            <div class="box-b">
              <div class="row">
                <div class="col">
                  <label class="lbl">Choose a username:</label>
                  <input id="username" class="txt" type="text" placeholder="cool_name123" maxlength="20">
                  <div class="small" style="margin-top:4px;">Letters/numbers/underscores only. This is what people see.</div>

                  <label class="lbl" style="margin-top:10px;">Email (needed for verification & password resets):</label>
                  <input id="email" class="txt" type="email" placeholder="you@example.com" autocomplete="email">

                  <label class="lbl" style="margin-top:10px;">Password:</label>
                  <input id="pass" class="txt" type="password" autocomplete="new-password">

                  <div class="statusLine">Your email will NOT be public on your profile.</div>
                </div>

                <div class="col">
                  <label class="lbl">Enter your month and year of birth:</label>
                  <div class="row">
                    <div class="col">
                      <select id="month" class="txt">
                        <option value="">Select Month</option>
                        <option>January</option><option>February</option><option>March</option><option>April</option>
                        <option>May</option><option>June</option><option>July</option><option>August</option>
                        <option>September</option><option>October</option><option>November</option><option>December</option>
                      </select>
                    </div>
                    <div class="col">
                      <select id="year" class="txt"><option value="">Select Year</option></select>
                    </div>
                  </div>
                  <div class="small" style="margin-top:4px;">Your birth date should not be shared publicly.</div>

                  <label class="lbl" style="margin-top:10px;">Are you a boy or a girl?</label>
                  <div class="genderRow">
                    <label><input type="radio" name="gender" value="boy"> Boy</label>
                    <label><input type="radio" name="gender" value="girl"> Girl</label>
                    <label><input type="radio" name="gender" value="other"> Other</label>
                  </div>

                  
                  <div class="avatarRow" style="gap:10px;">
                    <div class="avatarPick selected" data-avatar="male" title="Choose this avatar">
                      <img class="pixel" alt="Male avatar" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2032%2032%22%20shape-rendering%3D%22crispEdges%22%3E%0A%3Crect%20width%3D%2232%22%20height%3D%2232%22%20fill%3D%22transparent%22/%3E%0A%3C%21--%20shadow%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%2229%22%20width%3D%2214%22%20height%3D%222%22%20fill%3D%22%23000%22%20opacity%3D%22.15%22/%3E%0A%3C%21--%20hat%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%223%22%20width%3D%2214%22%20height%3D%224%22%20fill%3D%22%23d9493a%22/%3E%0A%3Crect%20x%3D%228%22%20y%3D%227%22%20width%3D%2216%22%20height%3D%222%22%20fill%3D%22%23c13c2f%22/%3E%0A%3C%21--%20head%20--%3E%0A%3Crect%20x%3D%2210%22%20y%3D%229%22%20width%3D%2212%22%20height%3D%2210%22%20fill%3D%22%23f2c39a%22/%3E%0A%3Crect%20x%3D%2211%22%20y%3D%2212%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2b2b%22/%3E%0A%3Crect%20x%3D%2219%22%20y%3D%2212%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2b2b%22/%3E%0A%3Crect%20x%3D%2213%22%20y%3D%2216%22%20width%3D%226%22%20height%3D%221%22%20fill%3D%22%23c98a63%22/%3E%0A%3C%21--%20body%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%2219%22%20width%3D%2214%22%20height%3D%227%22%20fill%3D%22%232b7bd4%22/%3E%0A%3Crect%20x%3D%2212%22%20y%3D%2219%22%20width%3D%228%22%20height%3D%227%22%20fill%3D%22%23ffffff%22%20opacity%3D%22.2%22/%3E%0A%3C%21--%20arms%20--%3E%0A%3Crect%20x%3D%226%22%20y%3D%2220%22%20width%3D%223%22%20height%3D%225%22%20fill%3D%22%23f2c39a%22/%3E%0A%3Crect%20x%3D%2223%22%20y%3D%2220%22%20width%3D%223%22%20height%3D%225%22%20fill%3D%22%23f2c39a%22/%3E%0A%3C%21--%20legs%20--%3E%0A%3Crect%20x%3D%2210%22%20y%3D%2226%22%20width%3D%225%22%20height%3D%223%22%20fill%3D%22%233b3b3b%22/%3E%0A%3Crect%20x%3D%2217%22%20y%3D%2226%22%20width%3D%225%22%20height%3D%223%22%20fill%3D%22%233b3b3b%22/%3E%0A%3C%21--%20shoes%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%2229%22%20width%3D%227%22%20height%3D%222%22%20fill%3D%22%23111%22/%3E%0A%3Crect%20x%3D%2216%22%20y%3D%2229%22%20width%3D%227%22%20height%3D%222%22%20fill%3D%22%23111%22/%3E%0A%3C/svg%3E">
                    </div>
                    <div class="avatarPick" data-avatar="female" title="Choose this avatar">
                      <img class="pixel" alt="Female avatar" src="data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2032%2032%22%20shape-rendering%3D%22crispEdges%22%3E%0A%3Crect%20width%3D%2232%22%20height%3D%2232%22%20fill%3D%22transparent%22/%3E%0A%3Crect%20x%3D%229%22%20y%3D%2229%22%20width%3D%2214%22%20height%3D%222%22%20fill%3D%22%23000%22%20opacity%3D%22.15%22/%3E%0A%3C%21--%20hair%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%223%22%20width%3D%2214%22%20height%3D%225%22%20fill%3D%22%237a34c8%22/%3E%0A%3Crect%20x%3D%228%22%20y%3D%228%22%20width%3D%2216%22%20height%3D%222%22%20fill%3D%22%23642aa6%22/%3E%0A%3C%21--%20head%20--%3E%0A%3Crect%20x%3D%2210%22%20y%3D%2210%22%20width%3D%2212%22%20height%3D%229%22%20fill%3D%22%23f2c39a%22/%3E%0A%3Crect%20x%3D%2211%22%20y%3D%2213%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2b2b%22/%3E%0A%3Crect%20x%3D%2219%22%20y%3D%2213%22%20width%3D%222%22%20height%3D%222%22%20fill%3D%22%232b2b2b%22/%3E%0A%3Crect%20x%3D%2213%22%20y%3D%2217%22%20width%3D%226%22%20height%3D%221%22%20fill%3D%22%23c98a63%22/%3E%0A%3C%21--%20body%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%2219%22%20width%3D%2214%22%20height%3D%227%22%20fill%3D%22%23ff7aa8%22/%3E%0A%3Crect%20x%3D%2212%22%20y%3D%2219%22%20width%3D%228%22%20height%3D%227%22%20fill%3D%22%23ffffff%22%20opacity%3D%22.15%22/%3E%0A%3C%21--%20arms%20--%3E%0A%3Crect%20x%3D%226%22%20y%3D%2220%22%20width%3D%223%22%20height%3D%225%22%20fill%3D%22%23f2c39a%22/%3E%0A%3Crect%20x%3D%2223%22%20y%3D%2220%22%20width%3D%223%22%20height%3D%225%22%20fill%3D%22%23f2c39a%22/%3E%0A%3C%21--%20legs%20--%3E%0A%3Crect%20x%3D%2210%22%20y%3D%2226%22%20width%3D%225%22%20height%3D%223%22%20fill%3D%22%233b3b3b%22/%3E%0A%3Crect%20x%3D%2217%22%20y%3D%2226%22%20width%3D%225%22%20height%3D%223%22%20fill%3D%22%233b3b3b%22/%3E%0A%3C%21--%20shoes%20--%3E%0A%3Crect%20x%3D%229%22%20y%3D%2229%22%20width%3D%227%22%20height%3D%222%22%20fill%3D%22%23111%22/%3E%0A%3Crect%20x%3D%2216%22%20y%3D%2229%22%20width%3D%227%22%20height%3D%222%22%20fill%3D%22%23111%22/%3E%0A%3C/svg%3E">
                    </div>
                  </div>
</div>

              <div id="msg" class="notice" style="display:none; margin-top:10px;"></div>

              <div class="continueRow">
                <button id="registerBtn" class="continueBtn">Continue</button>
              </div>
            </div>
          </div>
        </div>

        <div class="right">
          <div class="box sidebox">
            <div class="box-h">Already Registered?</div>
            <div class="box-b">
              If you just need to login, go to the <a href="./index.html">Login</a> page.
              <div style="height:10px;"></div>
              If you need to reset your password, use <a href="./reset.html">Password Reset</a>.
            </div>
          </div>

          <div class="box sidebox" style="margin-top:10px;">
            <div class="box-h">Hey Parents!</div>
            <div class="box-b">
              2DWORLD uses email verification to reduce fake accounts.
              <div style="margin-top:10px;"><b>Tip:</b> If the player is under 13, consider using a parent-controlled email.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div></div>

  <script type="module">
    import { register, prettyError, logout } from "./auth.js";

    const yearSel = document.getElementById("year");
    const now = new Date().getFullYear();
    for (let y = now; y >= now - 100; y--) {
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = String(y);
      yearSel.appendChild(opt);
    }

    const msg = document.getElementById("msg");
    function showMsg(text, good=false){
      msg.style.display = "block";
      msg.className = "notice " + (good ? "good" : "bad");
      msg.textContent = text;
    }

    // Avatar picker (stored on your profile)
    let avatar = "male";
    const picks = Array.from(document.querySelectorAll(".avatarPick"));
    function setPick(which){
      avatar = which;
      for (const p of picks) {
        p.classList.toggle("selected", p.dataset.avatar === which);
      }
    }
    for (const p of picks) {
      p.addEventListener("click", () => setPick(p.dataset.avatar));
    }



    document.getElementById("registerBtn").addEventListener("click", async () => {
      msg.style.display = "none";
      const username = document.getElementById("username").value;
      const email = document.getElementById("email").value.trim();
      const pass = document.getElementById("pass").value;
      const month = document.getElementById("month").value;
      const year = document.getElementById("year").value;
      const gender = document.querySelector("input[name='gender']:checked")?.value || "";

      try{
        await register({ username, email, password: pass, birthMonth: month, birthYear: year, gender });
        await logout(); // force verify first
        showMsg("Account created! Check your email to verify, then come back and login.", true);
        setTimeout(() => location.href = "./index.html", 1200);
      }catch(e){
        showMsg(prettyError(e));
      }
    });
  </script>
</body>
</html>
